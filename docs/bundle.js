!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";function t(t,e){e&&Object.keys(e).forEach(s=>{Array.isArray(e[s])?e[s].forEach(e=>{t.addEventListener(s,e)}):t.addEventListener(s,e[s])})}function e(t,s,i){if(i)return t.children&&t.children.forEach(t=>{e(t,s,i)}),void(t.instance&&t.instance[s]());t.instance&&t.instance[s](),t.children&&t.children.forEach(t=>{e(t,s,i)})}const s=Symbol("instance");function i(n){if(!0===n.skip)return null;const r=document.createElement(n.tag);if(n.textValue)if("object"==typeof n.textValue){const t=n.textValue;t.addSubscribers(t=>{r.textContent=t}),r.textContent=t.value}else r.textContent=n.textValue;let o;if(n.classList)if(Array.isArray(n.classList))n.classList.forEach(t=>{r.classList.add(t)});else{o=n.classList;const t=n.classList.value;Object.keys(t.value).forEach(e=>{return t.value[e]?r.classList.add(e):r.classList.remove(e)}),t.addSubscribers(t=>{Object.keys(t).forEach(e=>{return t[e]?r.classList.add(e):r.classList.remove(e)})})}if(n.attrs&&function(t,e){Object.keys(e).forEach(s=>{t.setAttribute(s,e[s])})}(r,n.attrs),n.children&&n.children.forEach(t=>{if(!t)return;if(Array.isArray(t))return t.forEach(t=>{if(!t.tag)return void r.appendChild(t);const e=i(Object.assign({},t,{parent:r}));e&&r.appendChild(e)}),void(t._parent=r);if(!t.tag)return void r.appendChild(t);const e=i(Object.assign({},t,{parent:r}));e&&r.appendChild(e)}),n.listeners&&t(r,n.listeners),n.instance&&(r[s]=n.instance,n.instance.onInit()),"object"==typeof n.skip){const s=document.createComment("");return n.skip.addSubscribers(i=>{const a=n.parent?n.parent:null;i?a&&(a.replaceChild(r,s),e(n,"reInit",!1),o&&o.reInit(),t(r,n.listeners)):a&&(!function(t,e){e&&Object.keys(e).forEach(s=>{Array.isArray(e[s])?e[s].forEach(e=>{t.removeEventListener(s,e)}):t.removeEventListener(s,e[s])})}(r,n.listeners),o&&o.destroy(),e(n,"destroy",!0),a.replaceChild(s,r))}),n.skip.value?r:s}return r}function n(t,e){const s=new t(e);return s.template.instance=s,s.template}class r{constructor(){this.reactive={}}onDestroy(){}onInit(){}reInit(){Object.keys(this.reactive).forEach(t=>{this.reactive[t].reInit()}),this.onInit()}destroy(){Object.keys(this.reactive).forEach(t=>{this.reactive[t].destroy()}),this.onDestroy()}}class o{constructor(t,e=!1){this._value=t,this.forces=e,this.setterTimeout=null,this.subscribers=[],this.isDestroy=!1,this.firstState=t}get value(){return this._value}destroy(){this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.isDestroy=!0}reInit(){this.isDestroy=!1,this.value=this.firstState}addSubscribers(t){this.isDestroy||this.subscribers.push(t)}set value(t){this.isDestroy||(this._value!==t||this.forces)&&(this._value=t,this.subscribers.length&&(this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.setterTimeout=requestAnimationFrame(()=>{this.subscribers.forEach(e=>{e(t)})})))}}function a(t){return new o(t)}function c(t){return new o(t)}const u=(t,e,s={},i)=>{if("function"==typeof e){const n={};return Object.keys(s).forEach(e=>{const i=s[e];n[e]="function"==typeof i?i(t):i}),e(Object.assign({},n,{index:i}))}return Object.assign({},e,{textValue:e.textValue(t),index:i})};function l(t,s,n={}){if(Array.isArray(t))return t.map((t,e)=>u(t,s,n,e));let r=t.value.map((t,e)=>u(t,s,n,e));return t.addSubscribers(t=>{let o=r._parent;r.length&&(r.forEach(t=>{e(t,"destroy",!0)}),function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(o)),t.length&&((r=t.map((t,e)=>u(t,s,n,e))).forEach(t=>{o.appendChild(i(t))}),r._parent=o)}),r}class h{constructor(t={}){this.obsArr=[],this.styles={},this.obs=new o(this.styles,!0),Object.keys(t).forEach(e=>{const s=t[e];"boolean"!=typeof s?(this.obsArr.push(s),this.styles[e]=s.value,s.addSubscribers(t=>{this.styles[e]=t,this.obs.value=this.styles})):this.styles[e]=s})}get value(){return this.obs}reInit(){this.obs.reInit(),this.obsArr.forEach(t=>{t.reInit()})}destroy(){this.obs.destroy(),this.obsArr.forEach(t=>{t.destroy()})}}function d(){return n(p)}class p extends r{constructor(){super(...arguments),this.reactive={counter:c(0)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.reactive.counter}}function v(t){return n(f,t)}class f extends r{constructor(t){super(),this.input=t,this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.input.counter}onInit(){console.log("init CountersShared")}onDestroy(){console.log("destroy CountersShared")}}class m extends r{constructor(){super(...arguments),this.reactive={show:a(!0)},this.onClick=(()=>{this.show.value=!this.show.value}),this.template={tag:"div",children:[{tag:"p",children:[{tag:"span",textValue:"Current value:"},{tag:"span",textValue:this.show}]},{tag:"button",listeners:{click:this.onClick},textValue:"Change state"},{tag:"div",textValue:"You will see me always"},{tag:"div",skip:this.show,textValue:"You will sometimes"}]}}get show(){return this.reactive.show}}function y(t={}){return n(g,t)}class g extends r{constructor(t){super(),this.inputs=t,this.template={tag:"div",children:[{tag:"span",textValue:this.counter},v({counter:this.counter})]}}get counter(){return this.inputs.value}onInit(){console.log(`Init ${this.counter.value}`)}onDestroy(){console.log(`Destroy ${this.counter.value}`)}}const b=c([]);setTimeout(()=>{b.value=[1,2,3,4,5],setTimeout(()=>{b.value=[1]},3e3)},3e3);class C extends r{constructor(){super(...arguments),this.reactive={counter:c(0),classOdd:a(!0)},this.template={tag:"div",classList:new h({odd:this.currentClass}),textValue:this.counter}}get counter(){return this.reactive.counter}get currentClass(){return this.reactive.classOdd}onInit(){const t=()=>{this.timer=window.setTimeout(()=>{this.counter.value+=1,this.currentClass.value=this.counter.value%2==0,t()},1e3)};t()}onDestroy(){clearTimeout(this.timer)}}function x(t){return n(E,t)}class E extends r{constructor(t){super(),this.input=t,this.onClick=(()=>{this.todoList.value=this.todoList.value.filter((t,e)=>e!==this.index)}),this.template={tag:"div",children:[{tag:"span",textValue:this.textValue},{tag:"button",textValue:"remove",listeners:{click:this.onClick}}]}}get todoList(){return this.input.todoList}get index(){return this.input.index}get textValue(){return this.input.value}}class k extends r{constructor(){super(),this.reactive={inputValue:c(""),todoList:c([])},this.onInput=(t=>{this.inputValue.value=t.target.value}),this.onClick=(()=>{this.inputValue.value&&(this.todoList.value=[...this.todoList.value,this.inputValue.value],this.inputValue.value="")}),this.inputBlock=i({tag:"input",attrs:{placeholder:"Write here"},listeners:{input:this.onInput}}),this.template={tag:"div",children:[{tag:"div",children:[this.inputBlock,{tag:"button",textValue:"add Todo",listeners:{click:this.onClick}}]},{tag:"div",children:[l(this.todoList,x,{todoList:this.todoList,index:(t,e)=>e,value:t=>t})]}]},this.inputValue.addSubscribers(t=>{this.inputBlock.value=t})}get inputValue(){return this.reactive.inputValue}get todoList(){return this.reactive.todoList}}document.getElementById("todo").appendChild(i(n(k))),document.getElementById("timer").appendChild(i(n(C)));const V=document.getElementById("counter");V.appendChild(i(d())),V.appendChild(i(d()));const L=document.getElementById("counter_input"),I=c(0);L.appendChild(i(v({counter:I}))),L.appendChild(i(v({counter:I}))),L.appendChild(i(v({counter:I}))),document.getElementById("simple_if").appendChild(i(n(m))),document.getElementById("simple_for").appendChild(i({tag:"div",children:[l([1,2,3,4,5,6,7],{tag:"div",textValue:t=>t})]})),document.getElementById("simple_for_component").appendChild(i({tag:"div",children:[l([1,2,3,4,5,6,7],d)]})),document.getElementById("simple_for_obs").appendChild(i({tag:"div",children:[l(b,y,{value:t=>c(t)})]}))});
//# sourceMappingURL=bundle.js.map
