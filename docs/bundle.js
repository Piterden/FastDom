!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";function t(t,e){e&&Object.keys(e).forEach(i=>{Array.isArray(e[i])?e[i].forEach(e=>{t.addEventListener(i,e)}):t.addEventListener(i,e[i])})}function e(t,i,n){if(n)return t.children&&t.children.forEach(t=>{e(t,i,n)}),void(t.instance&&t.instance[i]());t.instance&&t.instance[i](),t.children&&t.children.forEach(t=>{e(t,i,n)})}const i=Symbol("instance");function n(s){if(!0===s.skip)return null;const r=document.createElement(s.tag);if(s.textValue)if("object"==typeof s.textValue){const t=s.textValue;t.addSubscribers(t=>{r.textContent=t}),r.textContent=t.value}else r.textContent=s.textValue;if(s.classList&&s.classList.forEach(t=>{r.classList.add(t)}),s.attrs&&function(t,e){Object.keys(e).forEach(i=>{t.setAttribute(i,e[i])})}(r,s.attrs),s.children&&s.children.forEach(t=>{if(!t)return;if(Array.isArray(t))return t.forEach(t=>{if(!t.tag)return void r.appendChild(t);const e=n(Object.assign({},t,{parent:r}));e&&r.appendChild(e)}),void(t._parent=r);if(!t.tag)return void r.appendChild(t);const e=n(Object.assign({},t,{parent:r}));e&&r.appendChild(e)}),s.listeners&&t(r,s.listeners),s.instance&&(r[i]=s.instance,s.instance.onInit()),"object"==typeof s.skip){const i=document.createComment("");return s.skip.addSubscribers(n=>{const o=s.parent?s.parent:null;n?o&&(o.replaceChild(r,i),e(s,"reInit",!1),t(r,s.listeners)):o&&(!function(t,e){e&&Object.keys(e).forEach(i=>{Array.isArray(e[i])?e[i].forEach(e=>{t.removeEventListener(i,e)}):t.removeEventListener(i,e[i])})}(r,s.listeners),e(s,"destroy",!0),o.replaceChild(i,r))}),s.skip.value?r:i}return r}function s(t,e){const i=new t(e);return i.template.instance=i,i.template}class r{constructor(){this.reactive={}}onDestroy(){}onInit(){}reInit(){Object.keys(this.reactive).forEach(t=>{this.reactive[t].reInit()}),this.onInit()}destroy(){Object.keys(this.reactive).forEach(t=>{this.reactive[t].destroy()}),this.onDestroy()}}class o{constructor(t){this._value=t,this.setterTimeout=null,this.subscribers=[],this.isDestroy=!1,this.firstState=t}get value(){return this._value}destroy(){this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.isDestroy=!0}reInit(){this.isDestroy=!1,this.value=this.firstState}addSubscribers(t){this.isDestroy||this.subscribers.push(t)}set value(t){this.isDestroy||this._value!==t&&(this._value=t,this.subscribers.length&&(this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.setterTimeout=requestAnimationFrame(()=>{this.subscribers.forEach(e=>{e(t)})})))}}function a(t){return new o(t)}const u=(t,e,i={},n)=>{if("function"==typeof e){const s={};return Object.keys(i).forEach(e=>{const n=i[e];s[e]="function"==typeof n?n(t):n}),e(Object.assign({},s,{index:n}))}return Object.assign({},e,{textValue:e.textValue(t),index:n})};function c(t,i,s={}){if(Array.isArray(t))return t.map((t,e)=>u(t,i,s,e));let r=t.value.map((t,e)=>u(t,i,s,e));return t.addSubscribers(t=>{let o=r._parent;r.length&&(r.forEach(t=>{e(t,"destroy",!0)}),function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(o)),t.length&&((r=t.map((t,e)=>u(t,i,s,e))).forEach(t=>{o.appendChild(n(t))}),r._parent=o)}),r}function l(){return s(h)}class h extends r{constructor(){super(...arguments),this.reactive={counter:a(0)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.reactive.counter}}function d(t){return s(p,t)}class p extends r{constructor(t){super(),this.input=t,this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.input.counter}onInit(){console.log("init CountersShared")}onDestroy(){console.log("destroy CountersShared")}}class v extends r{constructor(){var t;super(...arguments),this.reactive={show:(t=!0,new o(t))},this.onClick=(()=>{this.show.value=!this.show.value}),this.template={tag:"div",children:[{tag:"p",children:[{tag:"span",textValue:"Current value:"},{tag:"span",textValue:this.show}]},{tag:"button",listeners:{click:this.onClick},textValue:"Change state"},{tag:"div",textValue:"You will see me always"},{tag:"div",skip:this.show,textValue:"You will sometimes"}]}}get show(){return this.reactive.show}}function m(t={}){return s(f,t)}class f extends r{constructor(t){super(),this.inputs=t,this.template={tag:"div",children:[{tag:"span",textValue:this.counter},d({counter:this.counter})]}}get counter(){return this.inputs.value}onInit(){console.log(`Init ${this.counter.value}`)}onDestroy(){console.log(`Destroy ${this.counter.value}`)}}const g=a([]);setTimeout(()=>{g.value=[1,2,3,4,5],setTimeout(()=>{g.value=[1]},3e3)},3e3);class y extends r{constructor(){super(...arguments),this.reactive={counter:a(0)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"div",textValue:this.counter}}get counter(){return this.reactive.counter}onInit(){const t=()=>{this.timer=window.setTimeout(()=>{this.counter.value+=1,t()},1e3)};t()}onDestroy(){clearTimeout(this.timer)}}function C(t){return s(b,t)}class b extends r{constructor(t){super(),this.input=t,this.onClick=(()=>{this.todoList.value=this.todoList.value.filter((t,e)=>e!==this.index)}),this.template={tag:"div",children:[{tag:"span",textValue:this.textValue},{tag:"button",textValue:"remove",listeners:{click:this.onClick}}]}}get todoList(){return this.input.todoList}get index(){return this.input.index}get textValue(){return this.input.value}}class x extends r{constructor(){super(),this.reactive={inputValue:a(""),todoList:a([])},this.onInput=(t=>{this.inputValue.value=t.target.value}),this.onClick=(()=>{this.inputValue.value&&(this.todoList.value=[...this.todoList.value,this.inputValue.value],this.inputValue.value="")}),this.inputBlock=n({tag:"input",attrs:{placeholder:"Write here"},listeners:{input:this.onInput}}),this.template={tag:"div",children:[{tag:"div",children:[this.inputBlock,{tag:"button",textValue:"add Todo",listeners:{click:this.onClick}}]},{tag:"div",children:[c(this.todoList,C,{todoList:this.todoList,index:(t,e)=>e,value:t=>t})]}]},this.inputValue.addSubscribers(t=>{this.inputBlock.value=t})}get inputValue(){return this.reactive.inputValue}get todoList(){return this.reactive.todoList}}document.getElementById("todo").appendChild(n(s(x))),document.getElementById("timer").appendChild(n(s(y)));const k=document.getElementById("counter");k.appendChild(n(l())),k.appendChild(n(l()));const E=document.getElementById("counter_input"),V=a(0);E.appendChild(n(d({counter:V}))),E.appendChild(n(d({counter:V}))),E.appendChild(n(d({counter:V}))),document.getElementById("simple_if").appendChild(n(s(v))),document.getElementById("simple_for").appendChild(n({tag:"div",children:[c([1,2,3,4,5,6,7],{tag:"div",textValue:t=>t})]})),document.getElementById("simple_for_component").appendChild(n({tag:"div",children:[c([1,2,3,4,5,6,7],l)]})),document.getElementById("simple_for_obs").appendChild(n({tag:"div",children:[c(g,m,{value:t=>a(t)})]}))});
//# sourceMappingURL=bundle.js.map
