!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";function t(t,e){e&&Object.keys(e).forEach(n=>{Array.isArray(e[n])?e[n].forEach(e=>{t.addEventListener(n,e)}):t.addEventListener(n,e[n])})}const e=Symbol("instance");function n(s){if(!0===s.skip)return null;const i=document.createElement(s.tag);if(s.textValue)if("object"==typeof s.textValue){const t=s.textValue;t.addSubscribers(t=>{i.textContent=t}),i.textContent=t.value}else i.textContent=s.textValue;if(s.classList&&s.classList.forEach(t=>{i.classList.add(t)}),s.attrs&&function(t,e){Object.keys(e).forEach(n=>{t.setAttribute(n,e[n])})}(i,s.attrs),s.children&&s.children.forEach(t=>{if(!t)return;if(Array.isArray(t))return t.forEach(t=>{if(!t.tag)return void i.appendChild(t);const e=n(Object.assign({},t,{parent:i}));e&&i.appendChild(e)}),void(t._parent=i);if(!t.tag)return void i.appendChild(t);const e=n(Object.assign({},t,{parent:i}));e&&i.appendChild(e)}),s.listeners&&t(i,s.listeners),s.instance&&(i[e]=s.instance,s.instance.onInit()),"object"==typeof s.skip){const e=document.createComment("");return s.skip.addSubscribers(n=>{const r=s.parent?s.parent:null;n?r&&(r.replaceChild(i,e),s.instance&&s.instance.reInit(),t(i,s.listeners)):r&&(!function(t,e){e&&Object.keys(e).forEach(n=>{Array.isArray(e[n])?e[n].forEach(e=>{t.removeEventListener(n,e)}):t.removeEventListener(n,e[n])})}(i,s.listeners),s.instance&&s.instance.destroy(),r.replaceChild(e,i))}),s.skip.value?i:e}return i}function s(t,e){const n=new t(e);return n.template.instance=n,n.template}class i{constructor(){this.reactive={}}onDestroy(){}onInit(){}reInit(){Object.keys(this.reactive).forEach(t=>{this.reactive[t].reInit()}),this.onInit()}destroy(){Object.keys(this.reactive).forEach(t=>{this.reactive[t].destroy()}),this.onDestroy()}}class r{constructor(t){this._value=t,this.setterTimeout=null,this.subscribers=[],this.isDestroy=!1,this.firstState=t}get value(){return this._value}destroy(){this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.isDestroy=!0}reInit(){this.isDestroy=!1,this.value=this.firstState}addSubscribers(t){this.isDestroy||this.subscribers.push(t)}set value(t){this.isDestroy||this._value!==t&&(this._value=t,this.subscribers.length&&(this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.setterTimeout=requestAnimationFrame(()=>{this.subscribers.forEach(e=>{e(t)})})))}}function o(t){return new r(t)}function a(t,e,s={},i=(t=>t)){if(Array.isArray(t))return t.map(t=>{if("function"==typeof e){const n={};return Object.keys(s).forEach(e=>{const i=s[e];n[e]="function"==typeof i?i(t):i}),e(n)}return Object.assign({},e,{textValue:e.textValue(t)})});let r=t.value.map(t=>{if("function"==typeof e){const n={};return Object.keys(s).forEach(e=>{const i=s[e];n[e]="function"==typeof i?i(t):i}),e(n)}return Object.assign({},e,{textValue:e.textValue(t)})});return t.addSubscribers(t=>{let i=r._parent;r.length&&(r.forEach(t=>{t.instance&&t.instance.destroy()}),function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(i)),t.length&&((r=t.map(t=>{if("function"==typeof e){const n={};return Object.keys(s).forEach(e=>{const i=s[e];n[e]="function"==typeof i?i(t):i}),e(n)}return Object.assign({},e,{textValue:e.textValue(t)})})).forEach(t=>{i.appendChild(n(t))}),r._parent=i)}),r}function c(){return s(u)}class u extends i{constructor(){super(...arguments),this.reactive={counter:o(0)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.reactive.counter}}function l(t){return s(h,t)}class h extends i{constructor(t){super(),this.input=t,this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.input.counter}}class d extends i{constructor(){var t;super(...arguments),this.reactive={show:(t=!0,new r(t))},this.onClick=(()=>{this.show.value=!this.show.value}),this.template={tag:"div",children:[{tag:"p",children:[{tag:"span",textValue:"Current value:"},{tag:"span",textValue:this.show}]},{tag:"button",listeners:{click:this.onClick},textValue:"Change state"},{tag:"div",textValue:"You will see me always"},{tag:"div",skip:this.show,textValue:"You will sometimes"}]}}get show(){return this.reactive.show}}function p(t={}){return s(f,t)}class f extends i{constructor(t){super(),this.inputs=t,this.template={tag:"div",textValue:this.inputs.value}}onInit(){console.log(`Init ${this.inputs.value}`)}onDestroy(){console.log(`Destroy ${this.inputs.value}`)}}const m=o([]);setTimeout(()=>{m.value=[1,2,3,4,5],setTimeout(()=>{m.value=[1]},3e3)},3e3);class v extends i{constructor(){super(...arguments),this.reactive={counter:o(0)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"div",textValue:this.counter}}get counter(){return this.reactive.counter}onInit(){const t=()=>{this.timer=window.setTimeout(()=>{this.counter.value+=1,t()},1e3)};t()}onDestroy(){clearTimeout(this.timer)}}document.getElementById("timer").appendChild(n(s(v)));const y=document.getElementById("counter");y.appendChild(n(c())),y.appendChild(n(c()));const g=document.getElementById("counter_input"),b=o(0);g.appendChild(n(l({counter:b}))),g.appendChild(n(l({counter:b}))),g.appendChild(n(l({counter:b}))),document.getElementById("simple_if").appendChild(n(s(d))),document.getElementById("simple_for").appendChild(n({tag:"div",children:[a([1,2,3,4,5,6,7],{tag:"div",textValue:t=>t})]})),document.getElementById("simple_for_component").appendChild(n({tag:"div",children:[a([1,2,3,4,5,6,7],c)]})),document.getElementById("simple_for_obs").appendChild(n({tag:"div",children:[a(m,p,{value:t=>t})]}))});
//# sourceMappingURL=bundle.js.map
