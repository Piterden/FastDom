!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";function t(t,e){e&&Object.keys(e).forEach(n=>{Array.isArray(e[n])?e[n].forEach(e=>{t.addEventListener(n,e)}):t.addEventListener(n,e[n])})}function e(t,n,i){if(i)return t.children&&t.children.forEach(t=>{e(t,n,i)}),void(t.instance&&t.instance[n]());t.instance&&t.instance[n](),t.children&&t.children.forEach(t=>{e(t,n,i)})}const n=Symbol("instance");function i(s){if(!0===s.skip)return null;const r=document.createElement(s.tag);if(s.textValue)if("object"==typeof s.textValue){const t=s.textValue;t.addSubscribers(t=>{r.textContent=t}),r.textContent=t.value}else r.textContent=s.textValue;if(s.classList&&s.classList.forEach(t=>{r.classList.add(t)}),s.attrs&&function(t,e){Object.keys(e).forEach(n=>{t.setAttribute(n,e[n])})}(r,s.attrs),s.children&&s.children.forEach(t=>{if(!t)return;if(Array.isArray(t))return t.forEach(t=>{if(!t.tag)return void r.appendChild(t);const e=i(Object.assign({},t,{parent:r}));e&&r.appendChild(e)}),void(t._parent=r);if(!t.tag)return void r.appendChild(t);const e=i(Object.assign({},t,{parent:r}));e&&r.appendChild(e)}),s.listeners&&t(r,s.listeners),s.instance&&(r[n]=s.instance,s.instance.onInit()),"object"==typeof s.skip){const n=document.createComment("");return s.skip.addSubscribers(i=>{const o=s.parent?s.parent:null;i?o&&(o.replaceChild(r,n),e(s,"reInit",!1),t(r,s.listeners)):o&&(!function(t,e){e&&Object.keys(e).forEach(n=>{Array.isArray(e[n])?e[n].forEach(e=>{t.removeEventListener(n,e)}):t.removeEventListener(n,e[n])})}(r,s.listeners),e(s,"destroy",!0),o.replaceChild(n,r))}),s.skip.value?r:n}return r}function s(t,e){const n=new t(e);return n.template.instance=n,n.template}class r{constructor(){this.reactive={}}onDestroy(){}onInit(){}reInit(){Object.keys(this.reactive).forEach(t=>{this.reactive[t].reInit()}),this.onInit()}destroy(){Object.keys(this.reactive).forEach(t=>{this.reactive[t].destroy()}),this.onDestroy()}}class o{constructor(t){this._value=t,this.setterTimeout=null,this.subscribers=[],this.isDestroy=!1,this.firstState=t}get value(){return this._value}destroy(){this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.isDestroy=!0}reInit(){this.isDestroy=!1,this.value=this.firstState}addSubscribers(t){this.isDestroy||this.subscribers.push(t)}set value(t){this.isDestroy||this._value!==t&&(this._value=t,this.subscribers.length&&(this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.setterTimeout=requestAnimationFrame(()=>{this.subscribers.forEach(e=>{e(t)})})))}}function c(t){return new o(t)}const a=(t,e,n={})=>{if("function"==typeof e){const i={};return Object.keys(n).forEach(e=>{const s=n[e];i[e]="function"==typeof s?s(t):s}),e(i)}return Object.assign({},e,{textValue:e.textValue(t)})};function u(t,n,s={}){if(Array.isArray(t))return t.map(t=>a(t,n,s));let r=t.value.map(t=>a(t,n,s));return t.addSubscribers(t=>{let o=r._parent;r.length&&(r.forEach(t=>{e(t,"destroy",!0)}),function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(o)),t.length&&((r=t.map(t=>a(t,n,s))).forEach(t=>{o.appendChild(i(t))}),r._parent=o)}),r}function l(){return s(h)}class h extends r{constructor(){super(...arguments),this.reactive={counter:c(0)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.reactive.counter}}function d(t){return s(p,t)}class p extends r{constructor(t){super(),this.input=t,this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.input.counter}onInit(){console.log("init CountersShared")}onDestroy(){console.log("destroy CountersShared")}}class f extends r{constructor(){var t;super(...arguments),this.reactive={show:(t=!0,new o(t))},this.onClick=(()=>{this.show.value=!this.show.value}),this.template={tag:"div",children:[{tag:"p",children:[{tag:"span",textValue:"Current value:"},{tag:"span",textValue:this.show}]},{tag:"button",listeners:{click:this.onClick},textValue:"Change state"},{tag:"div",textValue:"You will see me always"},{tag:"div",skip:this.show,textValue:"You will sometimes"}]}}get show(){return this.reactive.show}}function m(t={}){return s(v,t)}class v extends r{constructor(t){super(),this.inputs=t,this.template={tag:"div",children:[{tag:"span",textValue:this.counter},d({counter:this.counter})]}}get counter(){return this.inputs.value}onInit(){console.log(`Init ${this.counter.value}`)}onDestroy(){console.log(`Destroy ${this.counter.value}`)}}const y=c([]);setTimeout(()=>{y.value=[1,2,3,4,5],setTimeout(()=>{y.value=[1]},3e3)},3e3);class g extends r{constructor(){super(...arguments),this.reactive={counter:c(0)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"div",textValue:this.counter}}get counter(){return this.reactive.counter}onInit(){const t=()=>{this.timer=window.setTimeout(()=>{this.counter.value+=1,t()},1e3)};t()}onDestroy(){clearTimeout(this.timer)}}document.getElementById("timer").appendChild(i(s(g)));const C=document.getElementById("counter");C.appendChild(i(l())),C.appendChild(i(l()));const b=document.getElementById("counter_input"),E=c(0);b.appendChild(i(d({counter:E}))),b.appendChild(i(d({counter:E}))),b.appendChild(i(d({counter:E}))),document.getElementById("simple_if").appendChild(i(s(f))),document.getElementById("simple_for").appendChild(i({tag:"div",children:[u([1,2,3,4,5,6,7],{tag:"div",textValue:t=>t})]})),document.getElementById("simple_for_component").appendChild(i({tag:"div",children:[u([1,2,3,4,5,6,7],l)]})),document.getElementById("simple_for_obs").appendChild(i({tag:"div",children:[u(y,m,{value:t=>c(t)})]}))});
//# sourceMappingURL=bundle.js.map
